{% load i18n %}
{% load render %}
{% load hasrelated %}

<div class="inline-group">
  {% with inline_admin_formset.formset.instance as section %}

  <h2>{{ inline_admin_formset.opts.verbose_name_plural|title }} &nbsp; (drag and drop to reorder)</h2>
      {{ inline_admin_formset.formset.management_form }}
      {{ inline_admin_formset.formset.non_form_errors }}

  <div id='blocks' class='dragparent'>
      {% if inline_admin_formset.formset.instance.is_root %}
         <div style="margin-top: 5px; margin-left: 5px;"><i>The Root node has no page blocks.</i></div>
      {% endif %}
      
      <table width="100%">
			{% for block in section.pageblock_set.all %}
			   <tr id="pageblock-{{block.id}}" class="draggable {% cycle 'admin_block_view_row1' 'admin_block_view_row2' %}">
                   <td width="7%" style="vertical-align: middle"><span title="drag to reorder sections" class="draghandle ui-icon ui-icon-arrowthick-2-n-s"></span></td>
	               <td width="15%">
	                   <h3 onmouseover="this.style.cursor='move'">{{block.content_type.name|title}}</h3>
	               </td>
			       <td class="admin_block_column">
				       {% if block.label %}<h4>{{ block.label }}</h4>{% endif %}
				       {% render block %}
			       </td>
			      <td class="admin_tools_column">
			         <span class="edit">
                        <!-- If this is a complex object, punt to the admin console. Otherwise, do the pop-up action -->
                        {% if block.content_object|hasrelated %}
                            <a href="/admin/{{block.content_type.app_label}}/{{block.content_type.model}}/{{block.object_id}}/" class="changelink"><b>{% trans 'Change' %}</b></a></span>
                        {% else %}
                            <a href="#" onclick="return showPageBlockPopup('edit', 'Edit {{block.content_type.name|title}}', {{ block.id }});" class="changelink"><b>{% trans 'Change' %}</b></a></span>
                        {% endif %}
                     </span>
                     &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                     <!--  required for delete and parent save to work. do not remove -->
                     <input name='pageblock_set-{{forloop.counter|add:"-1"}}-label' value="{{ block.label }}" id='id_pagetblock_set-{{forloop.counter|add:"-1"}}-label'  type='hidden' />
                     <input name='pageblock_set-{{forloop.counter|add:"-1"}}-id' value="{{ block.id }}" id='id_pageblock_set-{{forloop.counter|add:"-1"}}-id' type="hidden">
                     <input name='pageblock_set-{{forloop.counter|add:"-1"}}-section' value="{{block.section.id}}" id='id_pageblock_set-{{forloop.counter|add:"-1"}}-section' type="hidden">
			         <span class="delete">
                        <a href='#' onclick="return showDeletePopup('PageBlock', {{ block.id }});" class="deletelink">{% trans 'Delete' %}</a></span>
                     </span>  
			      </td>
				</tr>
			 {% endfor %}
		 </table>
   </div>
   <br /><br /><br />
   {% if not inline_admin_formset.formset.instance.is_root %}
	   <ul class="object-tools">
	      <li>
	         <a id='add-new-pageblock' href="#" onclick="return showPageBlockPopup('add', 'Add Page Block', {{ section.id }});" class="addlink">Add Page Block</a>
	      </li>
	   </ul>
   {% endif %}
   
   {% endwith %}
</div>
